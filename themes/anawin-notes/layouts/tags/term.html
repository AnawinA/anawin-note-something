{{ define "main" }}
{{/* Single tag â€“ reuses notes list with tag filter applied */}}
{{ $sectionKey := printf "tag-%s" (.Data.Term | urlize) }}

<div class="container notes-page animate-fade-in-up">
    <div class="notes-header">
        <div class="notes-breadcrumb">
            <a href="/">Home</a>
            <span class="sep">â€º</span>
            <a href="/tags/">Tags</a>
            <span class="sep">â€º</span>
            #{{ .Data.Term }}
        </div>
        <h1 class="notes-title">ğŸ·ï¸ #{{ .Data.Term }}</h1>
        <div class="notes-count">{{ len .Pages }} note{{ if ne (len .Pages) 1 }}s{{ end }}</div>
    </div>

    {{/* Same toolbar as list.html */}}
    <div class="notes-toolbar">
        <div class="toolbar-left">
            <div class="view-toggle">
                <button data-view="gallery" class="active" title="Gallery">âŠ</button>
                <button data-view="list" title="List">â˜°</button>
            </div>
            <div class="toolbar-divider"></div>
            <div class="sort-group">
                <button data-sort="name">Name</button>
                <button data-sort="created" class="active">Created</button>
                <button data-sort="watched">Watched</button>
            </div>
            <button class="asc-btn desc" data-asc-toggle>â†‘</button>
            <div class="toolbar-divider"></div>
            <div class="label-toggle-wrap" data-label-toggle>
                <span>Label</span>
                <div class="toggle"></div>
            </div>
        </div>
        <div class="toolbar-right">
            <div class="size-range">
                <span>ğŸ”²</span>
                <input type="range" data-size-range min="140" max="400" value="220" />
                <span>ğŸ”³</span>
            </div>
            <div class="search-toggle-wrap">
                <button class="search-btn">ğŸ” Search</button>
                <div class="search-input-wrap">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" placeholder="Search in #{{ .Data.Term }}â€¦" />
                    <div class="search-options">
                        <button data-whole-word title="Whole words">W</button>
                        <button data-match-case title="Match case">Aa</button>
                    </div>
                    <button class="search-clear">âœ•</button>
                </div>
            </div>
        </div>
    </div>

    <div id="notes-list-container" data-section-key="{{ $sectionKey }}">
        <div class="notes-grid">
            {{ range .Pages }}
            <a href="{{ .RelPermalink }}" class="note-card" data-title="{{ .Title }}"
                data-desc="{{ with .Params.description }}{{ . }}{{ else }}{{ .Summary | truncate 120 }}{{ end }}"
                data-date="{{ .Date.Format " 2006-01-02T15:04:05Z07:00" }}" data-tags="{{ delimit .Params.tags " ," }}"
                data-url="{{ .RelPermalink }}">
                <div class="note-card-img">
                    {{ with .Params.image }}<img src="{{ . | relURL }}" alt="{{ $.Title }}" loading="lazy" />{{ else
                    }}ğŸ“{{ end }}
                </div>
                <div class="note-card-body">
                    {{ if .Section }}<div class="note-card-folder">ğŸ“ {{ .Section }}</div>{{ end }}
                    <div class="note-card-main">
                        <div class="note-card-title">{{ .Title }}</div>
                        <div class="note-card-desc">{{ with .Params.description }}{{ . }}{{ else }}{{ .Summary |
                            truncate 120 }}{{ end }}</div>
                    </div>
                    <div class="note-card-meta">
                        <div class="note-card-date">{{ dateFormat "Jan 2, 2006" .Date }}</div>
                        {{ with .Params.tags }}<div class="note-card-tags">{{ range first 3 . }}<span
                                class="tag-pill">{{ . }}</span>{{ end }}</div>{{ end }}
                    </div>
                </div>
            </a>
            {{ else }}
            <div class="empty-state">
                <div class="empty-icon">ğŸ·ï¸</div>
                <div class="empty-title">No notes with this tag</div>
            </div>
            {{ end }}
            <div class="load-sentinel"></div>
        </div>
    </div>
</div>
{{ end }}