{{ define "main" }}
{{ $sectionKey := printf "tag-%s" (.Data.Term | urlize) }}

<div class="container notes-page animate-fade-in-up">

    {{/* #notes-list-container wraps toolbar + grid so notes.js can find everything */}}
    <div id="notes-list-container" data-section-key="{{ $sectionKey }}">

        <div class="notes-header">
            <nav class="content-breadcrumb" aria-label="Breadcrumb">
                <a href="/">Home</a><span>â€º</span>
                <a href="/tags/">Tags</a><span>â€º</span>
                #{{ .Data.Term }}
            </nav>
            <h1 class="notes-title">ğŸ·ï¸ #{{ .Data.Term }}</h1>
            <div class="notes-count">{{ len .Pages }} note{{ if ne (len .Pages) 1 }}s{{ end }}</div>
        </div>

        <div class="notes-toolbar">
            <div class="toolbar-left">
                <div class="view-toggle">
                    <button data-view="gallery" title="Gallery">âŠ</button>
                    <button data-view="list" title="List">â˜°</button>
                </div>
                <div class="toolbar-divider"></div>
                <div class="sort-group">
                    <button data-sort="name">Name</button>
                    <button data-sort="created">Created</button>
                    <button data-sort="watched">Watched</button>
                </div>
                <button class="asc-btn" data-asc-toggle aria-label="Toggle order">â†‘</button>
                <div class="toolbar-divider"></div>
                <div class="label-toggle-wrap" data-label-toggle>
                    <span>Label</span>
                    <div class="toggle" role="switch" aria-checked="false"></div>
                </div>
            </div>
            <div class="toolbar-right">
                <div class="size-range">
                    <span title="Smaller">â–«</span>
                    <input type="range" data-size-range min="140" max="400" value="220" aria-label="Card size" />
                    <span title="Larger">â–ª</span>
                </div>
                <div class="search-toggle-wrap">
                    <button class="search-btn">ğŸ” Search</button>
                    <div class="search-input-wrap">
                        <span class="search-icon">ğŸ”</span>
                        <input type="text" placeholder="Search in #{{ .Data.Term }}â€¦" aria-label="Search notes" />
                        <div class="search-options">
                            <button data-whole-word title="Whole words">W</button>
                            <button data-match-case title="Match case">Aa</button>
                        </div>
                        <button class="search-clear">âœ•</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="notes-grid">
            {{ range .Pages }}
            <a href="{{ .RelPermalink }}" class="note-card" data-title="{{ .Title }}"
                data-desc="{{ with .Params.description }}{{ . }}{{ else }}{{ .Summary | truncate 120 }}{{ end }}"
                data-date="{{ .Date.Format " 2006-01-02T15:04:05Z07:00" }}" data-tags="{{ delimit .Params.tags " ," }}"
                data-url="{{ .RelPermalink }}">
                <div class="note-card-img">
                    {{ with .Params.image }}<img src="{{ . | relURL }}" alt="{{ $.Title }}" loading="lazy" />{{ else
                    }}ğŸ“{{ end }}
                </div>
                <div class="note-card-body">
                    {{ if .Section }}<div class="note-card-folder">ğŸ“ {{ .Section }}</div>{{ end }}
                    <div class="note-card-main">
                        <div class="note-card-title">{{ .Title }}</div>
                        <div class="note-card-desc">{{ with .Params.description }}{{ . }}{{ else }}{{ .Summary |
                            truncate 120 }}{{ end }}</div>
                    </div>
                    <div class="note-card-meta">
                        <div class="note-card-date">{{ dateFormat "Jan 2, 2006" .Date }}</div>
                        {{ with .Params.tags }}<div class="note-card-tags">{{ range first 3 . }}<span
                                class="tag-pill">{{ . }}</span>{{ end }}</div>{{ end }}
                    </div>
                </div>
            </a>
            {{ else }}
            <div class="empty-state">
                <div class="empty-icon">ğŸ·ï¸</div>
                <div class="empty-title">No notes with this tag</div>
            </div>
            {{ end }}
            <div class="load-sentinel"></div>
        </div>

    </div>{{/* end #notes-list-container */}}
</div>
{{ end }}